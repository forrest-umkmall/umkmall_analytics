version: 2

models:
  - name: mart_contact
    description: Unified contact mart - one row per email-phone pair, integrating marketing leads, purchases, and Eduqat data
    columns:
      - name: contact_key
        description: Composite key (email|phone) for contact identification
        meta:
          metrics:
            number_of_contacts:
              type: count_distinct
              description: Total number of unique contacts
      - name: email
        description: Contact email address
        meta:
          metrics:
            number_of_emails:
              type: count_distinct
              description: Number of contacts with email addresses
      - name: phone_number
        description: Contact phone number (+62 format)
        meta:
          metrics:
            number_of_wa:
              type: count_distinct
              description: Number of contacts with WhatsApp/phone numbers
      - name: first_name
        description: Contact first name (from purchase, eduqat, or marketing)
      - name: last_name
        description: Contact last name (from purchase, eduqat, or marketing)
      - name: first_purchased_at
        description: First purchase timestamp
      - name: last_purchased_at
        description: Most recent purchase timestamp
      - name: total_purchases
        description: Total number of purchases
      - name: eduqat_user_id
        description: Eduqat user ID
        meta:
          metrics:
            number_of_product_users:
              type: count_distinct
              description: Number of contacts who have made a purchase
      - name: eduqat_role
        description: Eduqat user role
      - name: eduqat_status
        description: Eduqat account status
      - name: eduqat_total_enrollments
        description: Total Eduqat enrollments from user record
      - name: eduqat_last_login_at
        description: Last Eduqat login timestamp
      - name: eduqat_created_at
        description: Eduqat account creation timestamp
      - name: eduqat_created_at_marketing_week
        description: ISO week number (1-53) when Eduqat account was created (Monday-Sunday weeks)
        meta:
          dimension:
            type: number
      - name: eduqat_created_at_marketing_year
        description: ISO year for the Eduqat account creation date
        meta:
          dimension:
            type: number
      - name: enrolled_courses_count
        description: Number of courses enrolled in
      - name: total_learning_time_seconds
        description: Total learning time in seconds
      - name: avg_learning_progress
        description: Average learning progress percentage
      - name: total_certificates
        description: Total certificates earned
      - name: prakerja_enrollments_count
        description: Number of Prakerja program enrollments
      - name: last_enrollment_at
        description: Most recent enrollment timestamp
      - name: provinsi_usaha
        description: Province of business
      - name: kota_kabupaten
        description: City/regency of business
      - name: bidang_usaha
        description: Business sector/field
      - name: pendapatan_bulanan
        description: Monthly revenue
      - name: lama_usaha
        description: Business duration/age
      - name: jumlah_karyawan
        description: Number of employees
      - name: nama_usaha
        description: Business name
      - name: nama_akun_media_sosial
        description: Social media account name
      - name: nama_akun_ecommerce
        description: E-commerce account name
      - name: tergabung_komunitas_umkm
        description: Member of UMKM community
      - name: memiliki_nib
        description: Has NIB (business registration)
      - name: memiliki_sertifikasi_halal
        description: Has halal certification
      - name: marketing_data_source
        description: Marketing data source identifier
      - name: marketing_sheet_name
        description: Marketing source Google Sheet name
      - name: marketing_timestamp
        description: Marketing form submission timestamp
      - name: last_activity_at
        description: Most recent activity timestamp across all sources

  - name: mart_enrollment
    description: Enrollment mart - one row per enrollment. Can be joined to mart_contact via email and mart_materials via enrollment_id.
    columns:
      - name: enrollment_id
        description: Unique enrollment ID
        meta:
          metrics:
            number_of_enrollments:
              type: count_distinct
              description: Total number of enrollments
      - name: uid
        description: UID
      - name: course_id
        description: Course ID
      - name: price_id
        description: Price ID
      - name: schedule_id
        description: Schedule ID
      - name: order_uid
        description: Order UID
      - name: user_id
        description: User ID
      - name: email
        description: User email (for joining to mart_contact)
      - name: phone_number
        description: User phone number
      - name: user_name
        description: User name
      - name: course_name
        description: Course name/title
      - name: course_type
        description: Type of course (e.g., online, offline, blended)
      - name: course_status
        description: Status of the course (e.g., draft, published, archived)
      - name: enrollment_started_at
        description: Enrollment start timestamp
        meta:
          metrics:
            number_of_enrollments_started:
              type: count_distinct
              description: Number of enrollments that have been started
      - name: enrollment_completed_at
        description: Completion timestamp
        meta:
          metrics:
            number_of_enrollments_completed:
              type: count_distinct
              description: Number of enrollments that have been completed
      - name: enrollment_expires_at
        description: Expiration timestamp
      - name: enrolled_at
        description: Enrollment creation timestamp
      - name: started_at_marketing_week
        description: ISO week number (1-53) when enrollment started (Monday-Sunday weeks)
        meta:
          dimension:
            type: number
      - name: started_at_marketing_year
        description: ISO year for the enrollment start date
        meta:
          dimension:
            type: number
      - name: completed_at_marketing_week
        description: ISO week number (1-53) when enrollment completed (Monday-Sunday weeks)
        meta:
          dimension:
            type: number
      - name: completed_at_marketing_year
        description: ISO year for the enrollment completion date
        meta:
          dimension:
            type: number
      - name: days_to_complete
        description: Number of days between enrollment start and completion
        meta:
          metrics:
            avg_days_to_complete:
              type: average
              description: Average number of days to complete an enrollment
      - name: learning_progress
        description: Learning progress percentage (0-100)
      - name: learning_time_seconds
        description: Total learning time in seconds
        meta:
          metrics:
            total_learning_time_min:
              type: sum
              description: Total learning time in minutes (with decimal places)
              sql: "ROUND(${learning_time_seconds}::numeric / 60, 2)"
      - name: total_tracked_time_seconds
        description: Total tracked time in seconds
      - name: last_tracked_at
        description: Last tracking timestamp
      - name: enrollment_type
        description: Type of enrollment
      - name: timezone
        description: User timezone
      - name: prakerja_id
        description: Prakerja program ID
      - name: is_prakerja_user
        description: Whether user is in Prakerja program
      - name: prakerja_redeem_code
        description: Prakerja redemption code
      - name: prakerja_redeem_at
        description: Prakerja redemption timestamp
      - name: certificate_count
        description: Number of certificates earned
      - name: certificates
        description: Certificate details (JSONB)
      - name: order_data
        description: Order data (JSONB)
      - name: purchased_at
        description: Payment timestamp from purchase form data
      - name: data_source
        description: Source identifier
      - name: extracted_at
        description: Data extraction timestamp

  - name: mart_materials
    description: Materials mart - one row per material per enrollment. Can be joined to mart_enrollment via enrollment_id and mart_contact via email.
    columns:
      - name: enrollment_id
        description: Enrollment ID (for joining to mart_enrollment)
      - name: user_id
        description: User ID
      - name: course_id
        description: Course ID
      - name: material_id
        description: Material ID
        meta:
          metrics:
            number_of_materials:
              type: count_distinct
              description: Total number of unique materials
      - name: email
        description: User email (for joining to mart_contact)
      - name: phone_number
        description: User phone number
      - name: user_name
        description: User name
      - name: course_name
        description: Course name/title
      - name: material_type
        description: Type of material (video, text, rich_text, self-assessment, ai_tutor, etc.)
      - name: material_is_required
        description: Whether the material is required for course completion
      - name: material_started_at
        description: Timestamp when user started the material
        meta:
          metrics:
            number_of_materials_started:
              type: count_distinct
              description: Number of materials that have been started
      - name: material_completed_at
        description: Timestamp when user completed the material
        meta:
          metrics:
            number_of_materials_completed:
              type: count_distinct
              description: Number of materials that have been completed
      - name: material_tracked_time_seconds
        description: Time spent on material in seconds
        meta:
          metrics:
            total_material_time_min:
              type: sum
              description: Total time spent on materials in minutes
              sql: "ROUND(${material_tracked_time_seconds}::numeric / 60, 2)"
      - name: ai_tutor_status
        description: Status for AI tutor materials (DONE, etc.)
      - name: conversation_id
        description: AI tutor conversation ID
      - name: conversation_started_at
        description: AI tutor conversation start timestamp
      - name: conversation_ended_at
        description: AI tutor conversation end timestamp
      - name: submission_count
        description: Number of submissions for AI tutor
      - name: self_assessment_id
        description: Self-assessment ID
      - name: self_assessment_library_id
        description: Self-assessment library ID
      - name: require_feedback
        description: Whether self-assessment requires feedback
      - name: require_file_upload
        description: Whether self-assessment requires file upload
      - name: require_educator_approval
        description: Educator approval requirement level
      - name: data_source
        description: Source identifier
      - name: extracted_at
        description: Data extraction timestamp